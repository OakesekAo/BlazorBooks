@page "/"
@page "/page/{pageNo:int?}"

@inject IBookService BookService

<PageTitle>Home | Blazor Books</PageTitle>

<SectionContent SectionName="PageTitle">
    <h1 class="m-0 text-white fw-bold">Blazing books</h1>
    <h3 class="text-white mt-2">A library of hundreds of popular books</h3>
</SectionContent>

<div class="container-lg">
    <div class="row">
        <div class="col-md-9">
            <div class="row">
                <div class="col-sm-12">
                <div class="genre-list">
                    <div class="genre-item">
                        <a href="/" title="Top Books">Top Books</a>
                    </div>
                    @foreach (var g in _genres)
                    {
                        <div class="genre-item">
                            <a href="?genre=@g.Slug" title="@g.Name">@g.Name</a>
                            </div>
                    }
                    </div>
                </div>

                <h3 class="my-2">Top Books</h3>
                <div class="row">
                @foreach (var b in _books)
                {
                    <div class="col-sm-6 col-lg-3">
                        <a href="/books/@b.Id" title="@b.Title">
                            <figure bg-main-light>
                                <img src="@b.Image" alt="@b.Title"/>

                            </figure>
                            <div class="p-2">
                                <h6>@b.Title</h6>
                            </div>
                            </a>
                    </div>
                    }
                </div>
            </div>
        </div>
        <div class="col-md-3"></div>
    </div>

</div>

@code {
    [Parameter]
    public int? PageNo { get; set; } = 1;

    private GenreDto[] _genres = [];
    private BookListDto[] _books = [];
    private BookListDto[] _popularBooks = [];
    private int _totalCount = 0;

    private const int PageSize = 16;


    protected override async Task OnInitializedAsync()
    {
        var genretask =  BookService.GetGenresAsync(topOnly: true);
        var booksTask =  BookService.GetBooksAsync(PageNo ?? 1, PageSize);
        var popularTask =  BookService.GetPopularBooksAsync(10);

        _genres = await genretask;
        (_books, _totalCount) = await booksTask;
        _popularBooks = await popularTask;
        


    }

}
